{% extends "main.html" %}
{% block content %}
{% include "header.html" %}
<main id="index">
  <div class="">
    <div class="jumbotron bg-light text-center p-1 hero mb-0 d-flex justify-content-center align-items-center" style="min-height:100vh;">
      <div>
        {% if site_name == "Data Discovery Engine" %}
          <h1 id="home" class="logoText mt-5 logoFont">
            DATA<br class="d-sm-block d-md-none" /> DISCOVERY<br class="d-sm-block d-md-none" /> ENGINE
          </h1>
          <div id="animation_container" style="background-color:rgba(68, 68, 68, 00); width:640px; height:480px; zoom:.5;">
            <canvas id="canvas" width="640" height="480" style="position: absolute; display: block; background-color:rgba(68, 68, 68,0);"></canvas>
            <div id="dom_overlay_container" style="pointer-events:none; overflow:hidden; width:640px; height:480px; position: absolute; left: 0px; top: 0px; display: block;">
            </div>
          </div>
        {% endif %}
        <div class="m-5">
          <h4 class="text-muted lighter caps d-none d-md-block">
            {{site_desc | safe}}
          </h4>
          <h6 class="text-muted lighter caps d-block d-md-none">
            {{site_desc | safe}}
          </h6>
          <a class="text-muted" href="/about">Learn More <i class="fas fa-chevron-right"></i></a>
        </div>
      </div>
    </div>

    <div class="jumbotron grad">
      <div class="container d-flex justify-content-around m-auto flex-wrap">
        <div id="bestPractices" class="jumbotron bg-none text-center pRelative tip">
          <div class="link-wrapper">
            <a class="link hover-1 mt-5" href="./best-practices" style="z-index:2;">
              <h3 class="text-light">BEST PRACTICES <i class="fas fa-chevron-right d-inline d-md-none"></i></h3>
            </a>
            <p class="m-auto w-75 text-light o-0 d-none d-md-block">
              Follow best practices to make your data more findable
            </p>
            <p class="m-auto w-75 text-light d-sm-block d-md-none">
              Follow best practices to make your data more findable
            </p>
          </div>

          <div class="discoverBack"></div>
        </div>
        <div id="schemaPlayground" class="jumbotron bg-none text-center pRelative tip">
          <div class="link-wrapper">
            <a class="link hover-1 mt-5" href="./schema-playground" style="z-index:2;">
              <h3 class="text-light">SCHEMA PLAYGROUND <i class="fas fa-chevron-right d-inline d-md-none"></i></h3>
            </a>
            <p class="m-auto w-75 text-light o-0 d-none d-md-block">
              Build and host your own schema for better interoperability
            </p>
            <p class="m-auto w-75 text-light d-sm-block d-md-none">
              Build and host your own schema for better interoperability
            </p>
          </div>
          <div class="buildBack"></div>
        </div>
      </div>
      <div class="p-2 text-center text-light">
        <p class="lighter">
          Don't know where to start? <a id="demo" href="#" class="link text-light bold" @click.prevent="showHelp()" v-text="help?'Hide Help':'Click Here'"></a>
        </p>
      </div>
    </div>

    <div class="jumbotron bg-light">
      <div class="container d-flex justify-content-around m-auto flex-wrap">
        <h3 class="text-muted lighter caps w-100 text-center">Discover & Access Dataset Metadata</h3>
        <h5 class="text-muted lighter caps mb-5 w-100 text-center">See what structured metadata can do</h5>
        <div class="card col-sm-12 col-md-6">
          <img src="/static/img/logofull.svg" class="card-img-top p-2" alt="Metadata Plus" height="115px">
          <div class="card-body">
            <h5 class="card-title mainTextDark">METADATA PLUS</h5>
            <h5 class="card-text text-muted">
              A service to transforms non-structured published metadata into <a href="https://schema.org/" rel="noreferrer" target="_blank">Schema.org</a>-standard structured metadata.
            </h5>
            <!-- <p class="card-text text-muted"><a href="https://schema.org/" rel="noreferrer" target="_blank">Schema.org</a>-Standard Structured Metadata Injector</p> -->
            <a href="https://metadataplus.biothings.io" target="_blank">
              Learn More <i class="fas fa-external-link-alt"></i>
            </a>
          </div>
        </div>
        <div class="card col-sm-12 col-md-6">
          <img src="/static/img/crawlerfull.svg" class="card-img-top p-2" alt="Metadata Crawler" height="115px">
          <div class="card-body">
            <h5 class="card-title mainTextDark">METADATA CRAWLER</h5>
            <h5 class="card-text text-muted">
              A service that harvests biomedical <a href="https://schema.org/" rel="noreferrer" target="_blank">Schema.org</a>-standard structured dataset metadata and makes it available through an API.
            </h5>
            <!-- <p class="card-text text-muted">Serving structured dataset metadata in <a href="https://schema.org/" rel="noreferrer" target="_blank">Schema.org</a> standard.</p> -->
            <a href="https://crawler.biothings.io" target="_blank">
              Learn More <i class="fas fa-external-link-alt"></i>
            </a>
          </div>
        </div>
      </div>
    </div>

    <div class="jumbotron bg-light text-muted text-center">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-6">
            <img class="w-100 rounded" src="/static/img/involved-01.png" style="border-radius:20px;" alt="join us"/>
          </div>
          <div class="col-sm-12 col-md-6 p-3">
            <h3 class="text-muted lighter caps" id="get-involved">Get Involved!</h3>
            <img class="margin20" src="./static/img/cd2h-logo.png" width="200px" alt="logo"/>
            <p class="text-muted w-75 m-auto lighter">
              The CD2H project uses the onboarding form to track community interest and engagement in CD2H projects and working groups. You are welcome to participate at any level, whether contributing requirements, code, or just casually following the project as it progresses. Simply check the box indicating you're interested in the 'discovery engine', we will get in touch. <a target="_blank" href="mailto:data2health@gmail.com">Contact us</a> if you have any questions.
            </p>
            <a target="_blank" href="http://bit.ly/cd2h-onboarding-form" role="button" class="btn themeButton pulse text-light mt-4">Join Now</a>
          </div>
        </div>
      </div>
    </div>

    <div class="jumbotron bg-light text-muted text-center">
      <div class="container">
        <div class="row">
          <div class="col-sm-12 col-md-6 p-3">
            <h3 class="text-muted lighter caps" id="connect">CONNECT</h3>
            <dl>
              <dt>
                <i class="fab fa-github fa-2x mainTextDark"></i>
                <br />
                <a class="mainTextDark" target="_blank" href="https://github.com/data2health/rdp-portal"> Reusable data best practice portal (rdp-portal)</a>
              </dt>
              <dd class="lighter">
                Learn more about our project on GitHub
              </dd>
              <dt>
                <i class="fab fa-github fa-2x mainTextLight"></i>
                <br />
                <a class="mainTextLight" target="_blank" href="https://github.com/biothings/discovery-app"> Data Discovery Engine Github</a>
              </dt>
              <dd class="lighter">
                Contribute to the development of this site on GitHub
              </dd>
            </dl>
          </div>
          <div class="col-sm-12 col-md-6">
            <img class="w-100 rounded" src="/static/img/connect.png" alt="join us"/>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>
<script src="https://cdnjs.cloudflare.com/ajax/libs/vue/2.4.2/vue.min.js"></script>
<script src="https://code.createjs.com/createjs-2015.11.26.min.js"></script>
<script src="./static/js/logo.js"></script>
<script src="https://unpkg.com/tippy.js@3/dist/tippy.all.min.js"></script>
<script>
var app = new Vue({
    el: '#index',
		data: function(){
			return {
        help:false,
        bestPractices : null,
        schemaPlayground : null
			}
		},
    watch:{
      help:function(h){
        var self = this
        if (h) {
          self.bestPractices.instances[0].show()
          self.schemaPlayground.instances[0].show()
        }else{
          self.bestPractices.instances[0].hide()
          self.schemaPlayground.instances[0].hide()
        }
      }
    },
    methods:{
      showHelp(){
        this.help= !this.help
      },
      initAnimation(){
        var canvas, stage, exportRoot, anim_container, dom_overlay_container, fnStartAnimation;
        function init() {
        	canvas = document.getElementById("canvas");
        	anim_container = document.getElementById("animation_container");
        	dom_overlay_container = document.getElementById("dom_overlay_container");
        	var comp=AdobeAn.getComposition("46DA4F4F7E89411CA5216CDF046C8633");
        	var lib=comp.getLibrary();
        	var loader = new createjs.LoadQueue(false);
        	loader.addEventListener("fileload", function(evt){handleFileLoad(evt,comp)});
        	loader.addEventListener("complete", function(evt){handleComplete(evt,comp)});
        	var lib=comp.getLibrary();
        	loader.loadManifest(lib.properties.manifest);
        }
        function handleFileLoad(evt, comp) {
        	var images=comp.getImages();
        	if (evt && (evt.item.type == "image")) { images[evt.item.id] = evt.result; }
        }
        function handleComplete(evt,comp) {
        	//This function is always called, irrespective of the content. You can use the variable "stage" after it is created in token create_stage.
        	var lib=comp.getLibrary();
        	var ss=comp.getSpriteSheet();
        	var queue = evt.target;
        	var ssMetadata = lib.ssMetadata;
        	for(i=0; i<ssMetadata.length; i++) {
        		ss[ssMetadata[i].name] = new createjs.SpriteSheet( {"images": [queue.getResult(ssMetadata[i].name)], "frames": ssMetadata[i].frames} )
        	}
        	exportRoot = new lib.logo();
        	stage = new lib.Stage(canvas);
        	//Registers the "tick" event listener.
        	fnStartAnimation = function() {
        		stage.addChild(exportRoot);
        		createjs.Ticker.setFPS(lib.properties.fps);
        		createjs.Ticker.addEventListener("tick", stage)
        		stage.addEventListener("tick", handleTick)
        		function getProjectionMatrix(container, totalDepth) {
        			var focalLength = 528.25;
        			var projectionCenter = { x : lib.properties.width/2, y : lib.properties.height/2 };
        			var scale = (totalDepth + focalLength)/focalLength;
        			var scaleMat = new createjs.Matrix2D;
        			scaleMat.a = 1/scale;
        			scaleMat.d = 1/scale;
        			var projMat = new createjs.Matrix2D;
        			projMat.tx = -projectionCenter.x;
        			projMat.ty = -projectionCenter.y;
        			projMat = projMat.prependMatrix(scaleMat);
        			projMat.tx += projectionCenter.x;
        			projMat.ty += projectionCenter.y;
        			return projMat;
        		}
        		function handleTick(event) {
        			var cameraInstance = exportRoot.___camera___instance;
        			if(cameraInstance !== undefined && cameraInstance.pinToObject !== undefined)
        			{
        				cameraInstance.x = cameraInstance.pinToObject.x + cameraInstance.pinToObject.pinOffsetX;
        				cameraInstance.y = cameraInstance.pinToObject.y + cameraInstance.pinToObject.pinOffsetY;
        				if(cameraInstance.pinToObject.parent !== undefined && cameraInstance.pinToObject.parent.depth !== undefined)
        				cameraInstance.depth = cameraInstance.pinToObject.parent.depth + cameraInstance.pinToObject.pinOffsetZ;
        			}
        			applyLayerZDepth(exportRoot);
        		}
        		function applyLayerZDepth(parent)
        		{
        			var cameraInstance = parent.___camera___instance;
        			var focalLength = 528.25;
        			var projectionCenter = { 'x' : 0, 'y' : 0};
        			if(parent === exportRoot)
        			{
        				var stageCenter = { 'x' : lib.properties.width/2, 'y' : lib.properties.height/2 };
        				projectionCenter.x = stageCenter.x;
        				projectionCenter.y = stageCenter.y;
        			}
        			for(child in parent.children)
        			{
        				var layerObj = parent.children[child];
        				if(layerObj == cameraInstance)
        					continue;
        				applyLayerZDepth(layerObj, cameraInstance);
        				if(layerObj.layerDepth === undefined)
        					continue;
        				if(layerObj.currentFrame != layerObj.parent.currentFrame)
        				{
        					layerObj.gotoAndPlay(layerObj.parent.currentFrame);
        				}
        				var matToApply = new createjs.Matrix2D;
        				var cameraMat = new createjs.Matrix2D;
        				var totalDepth = layerObj.layerDepth ? layerObj.layerDepth : 0;
        				var cameraDepth = 0;
        				if(cameraInstance && !layerObj.isAttachedToCamera)
        				{
        					var mat = cameraInstance.getMatrix();
        					mat.tx -= projectionCenter.x;
        					mat.ty -= projectionCenter.y;
        					cameraMat = mat.invert();
        					cameraMat.prependTransform(projectionCenter.x, projectionCenter.y, 1, 1, 0, 0, 0, 0, 0);
        					cameraMat.appendTransform(-projectionCenter.x, -projectionCenter.y, 1, 1, 0, 0, 0, 0, 0);
        					if(cameraInstance.depth)
        						cameraDepth = cameraInstance.depth;
        				}
        				if(layerObj.depth)
        				{
        					totalDepth = layerObj.depth;
        				}
        				//Offset by camera depth
        				totalDepth -= cameraDepth;
        				if(totalDepth < -focalLength)
        				{
        					matToApply.a = 0;
        					matToApply.d = 0;
        				}
        				else
        				{
        					if(layerObj.layerDepth)
        					{
        						var sizeLockedMat = getProjectionMatrix(parent, layerObj.layerDepth);
        						if(sizeLockedMat)
        						{
        							sizeLockedMat.invert();
        							matToApply.prependMatrix(sizeLockedMat);
        						}
        					}
        					matToApply.prependMatrix(cameraMat);
        					var projMat = getProjectionMatrix(parent, totalDepth);
        					if(projMat)
        					{
        						matToApply.prependMatrix(projMat);
        					}
        				}
        				layerObj.transformMatrix = matToApply;
        			}
        		}
        	}
        	//Code to support hidpi screens and responsive scaling.
        	function makeResponsive(isResp, respDim, isScale, scaleType) {
        		var lastW, lastH, lastS=1;
        		window.addEventListener('resize', resizeCanvas);
        		resizeCanvas();
        		function resizeCanvas() {
        			var w = lib.properties.width, h = lib.properties.height;
        			var iw = window.innerWidth, ih=window.innerHeight;
        			var pRatio = window.devicePixelRatio || 1, xRatio=iw/w, yRatio=ih/h, sRatio=1;
        			if(isResp) {
        				if((respDim=='width'&&lastW==iw) || (respDim=='height'&&lastH==ih)) {
        					sRatio = lastS;
        				}
        				else if(!isScale) {
        					if(iw<w || ih<h)
        						sRatio = Math.min(xRatio, yRatio);
        				}
        				else if(scaleType==1) {
        					sRatio = Math.min(xRatio, yRatio);
        				}
        				else if(scaleType==2) {
        					sRatio = Math.max(xRatio, yRatio);
        				}
        			}
        			canvas.width = w*pRatio*sRatio;
        			canvas.height = h*pRatio*sRatio;
        			canvas.style.width = dom_overlay_container.style.width = anim_container.style.width =  w*sRatio+'px';
        			canvas.style.height = anim_container.style.height = dom_overlay_container.style.height = h*sRatio+'px';
        			stage.scaleX = pRatio*sRatio;
        			stage.scaleY = pRatio*sRatio;
        			lastW = iw; lastH = ih; lastS = sRatio;
        			stage.tickOnUpdate = false;
        			stage.update();
        			stage.tickOnUpdate = true;
        		}
        	}
        	makeResponsive(true,'both',false,1);
        	AdobeAn.compositionLoaded(lib.properties.id);
        	fnStartAnimation();
        }
        $( document ).ready(function() {
            init();
        });
        document.getElementById("animation_container").addEventListener('click', function(){
					init();
				})
      },

    },
    mounted:function(){
      this.initAnimation();
      this.bestPractices = tippy( '#bestPractices', {
          interactive:'true',
          arrow: 'true',
          hideOnClick:'false',
          trigger: 'manual',
          content: `<div class="mainBackLight text-light text-center p-1">
                        BEST PRACTICES
                    </div>
                    <div class="alert alert-light m-0">
                     If you have a dataset, and want to share it properly, so that others can find it, use it for their research and attribute your work properly.
                    </div>`,
          animation: 'fade',
          theme:'light',
        });
      this.schemaPlayground = tippy( '#schemaPlayground', {
          interactive:'true',
          arrow: 'true',
          hideOnClick:'false',
          trigger: 'manual',
          content: `<div class="mainBackDark text-light text-center p-1">
                      SCHEMA PLAYGROUND
                    </div>
                    <div class="alert alert-light m-0">
                      If you are starting a new project, and want to plan ahead, so that the data coming out of your project will be FAIR (Findable, Accessible, Interopeable, Reusable) from the beginning.
                    </div>`,
          animation: 'fade',
          theme:'light',
        });
    },
    created: function(){
    }

  });
</script>
{% include "footer.html" %}
{% endblock %}
